(()=>{"use strict";const e=(e,t)=>document.evaluate(e,t,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),t=async t=>{e(t,document.body).snapshotItem(0).click()},o=(t,o)=>{console.log("开始获取数据");let{element:s,parent:l}=t;l=e(l,document.body);for(let t=0;t<l.snapshotLength;t++){const n={};for(let o=0;o<s.length;o++)n[s[o].fieldName]=e(s[o].select,l.snapshotItem(t)).snapshotItem(0)?.data;o.push(n)}console.log(o)},s=async()=>{setTimeout((()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}),3e3)},l=(t,o)=>{console.log("开始监听节点");const{observerElement:s,observerTime:l,newChild:n}=t,c=e(s,document.body).snapshotItem(0),a=new MutationObserver((function(t,s){for(let s of t)if("childList"===s.type){const t={},l=s.addedNodes[0];for(let o of n)t[o.fieldName]=e(o.select,l).snapshotItem(0)?.data;o.push(t)}console.log(o)}));a.observe(c,{attributes:!0,childList:!0,subtree:!0}),0!==l?setTimeout((()=>{a.disconnect()}),60*l*1e3):setTimeout((()=>{a.disconnect()}),6e4)},n=async(e,c)=>{console.log("开始运行"),c.length>=20&&(chrome.runtime.sendMessage({data:c,type:"content"}),c.length=0);for(let a=0;a<e.length;a++)switch(e[a].id){case"loop":for(let t=0;t<e[a].circleCount;t++)setTimeout((()=>{console.log(`我是第${t}次循环`),n(e[a].child,c)}),3e3*t);break;case"click":t(e[a].clickElement);break;case"getData":o(e[a],c);break;case"observer":if(l(e[a],c),e[a].child)for(let t=0;t<e[a].child.length;t++)setTimeout((()=>{n(e[a].child,c)}),3e3*t);break;case"moveToBottom":console.log("我执行l"),s();break;default:continue}};(async()=>{let e=await(async e=>await chrome.storage.local.get(["projectInfo"]))();e=e.projectInfo;const t=[];e.length>0&&setTimeout((()=>{n(e,t)}),3e3)})()})();